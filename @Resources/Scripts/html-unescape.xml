local entityMap = {["lt"] = "<", ["gt"] = ">", ["amp"] = "&", ["quot"] = '"', ["apos"] = "'"}

local entitySwap = function(orig, n, s)
    return (n == "" and entityMap[s]) or (n == "#" and tonumber(s)) and string.char(s) or
        (n == "#x" and tonumber(s, 16)) and string.char(tonumber(s, 16)) or
        orig
end

function unescape(str)
    return (string.gsub(str, "(&(#?x?)([%d%a]+);)", entitySwap))
end
